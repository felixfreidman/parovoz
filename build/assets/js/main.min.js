"use strict";function inputAuthorization(){document.querySelectorAll(".form-input").forEach(function(e){var r;e.value||(r=addWarningEmptySpan(),e.classList.add("form-input--warning"),e=e.id,document.querySelector("[for=".concat(e,"]")).appendChild(r))})}function addWarningEmptySpan(){var e=document.createElement("span");return e.classList.add("empty--input"),e}function deleteWarningSpans(){document.querySelectorAll(".form-input").forEach(function(r){r.addEventListener("input",function(){var e=r.id,e=document.querySelector("[for=".concat(e,"]"));e.querySelector(".empty--input")&&(e.querySelector(".empty--input").remove(),r.classList.remove("form-input--warning"))})})}function eraseLocalStorage(){localStorage.removeItem("globalCounter"),localStorage.removeItem("bookedServices")}$(function(){$("#orderForm").on("submit",function(e){e.preventDefault();var r=$("#userName").val(),t=$("#userPhone").val(),o=$("#userEmail").val(),e=$("#userOrder").val(),n=document.querySelector(".order-button");n.textContent="Подтверждаем",$.ajax({type:"post",url:"/wp-admin/admin-ajax.php",data:{action:"ajax_form",name:r,phone:t,mail:o,order:e},success:function(e){n.textContent=e,setTimeout(eraseLocalStorage,300),setTimeout(function(){window.location.href="https://parovoz.yurin.biz/product/single-product/"},1200)}})})}),$(".order-button").on("click",function(){inputAuthorization()}),deleteWarningSpans(),Storage.prototype.setObj=function(e,r){return this.setItem(e,JSON.stringify(r))},Storage.prototype.getObj=function(e){return JSON.parse(this.getItem(e))};var globalCounter=0;localStorage.getItem("globalCounter")&&(globalCounter=localStorage.getItem("globalCounter"));var cardsArray,createBookingItem,bookBtn,createServiceOrder,createServiceTotal,updateUserOrderField,updateTotalNumber,deleteOrderFromLists,bookedItems,orderContainer,orderList,counter,booksArray=new Array;localStorage.getObj("bookedServices")&&(booksArray=localStorage.getObj("bookedServices")),document.querySelector(".article-card")&&(cardsArray=document.querySelectorAll(".article-card")).forEach(function(r){r.addEventListener("mouseover",function(){var e=(e=r.style.background).replace("linear-gradient(360deg, rgba(26, 47, 68, 0.9) 0%, rgba(26, 47, 68, 0) 100%)","linear-gradient( 360deg, rgba(212, 37, 21, 0.8) 0%, rgba(212, 37, 21, 0) 100%)");r.style.background=e}),r.addEventListener("mouseout",function(){var e=(e=r.style.background).replace("linear-gradient(360deg, rgba(212, 37, 21, 0.8) 0%, rgba(212, 37, 21, 0) 100%)","linear-gradient(360deg, rgba(26, 47, 68, 0.9) 0%, rgba(26, 47, 68, 0) 100%)");r.style.background=e})}),document.getElementById("orderDate")&&(document.getElementById("orderDate").valueAsDate=new Date),window.location.href.includes("product")&&(createBookingItem=function(){var e=document.querySelector(".service-header").textContent,r=document.querySelector(".price-tag").textContent,t=document.querySelector(".description-content").textContent,t={serviceCounter:parseInt(globalCounter),serviceName:e,servicePrice:r,serviceDescription:t};booksArray.push(t),localStorage.setObj("bookedServices",booksArray),localStorage.setItem("globalCounter",globalCounter),globalCounter++,window.location.href="book"},(bookBtn=document.querySelector(".service-data__book-btn")).addEventListener("click",createBookingItem)),window.location.href.includes("book")&&(createServiceOrder=function(e,r,t,o){return'\n    <div class="order-container order-service" id="service'.concat(o,'">\n    <div class="cross" id="cross').concat(o,'">\n        <div class="cross-one"> </div>\n        <div class="cross-two"></div>\n    </div>\n    <div class="order-row">\n        <div class="order-info">\n            <div class="order-header">').concat(e,'</div>\n            <div class="order-cost">').concat(r,' ₽ / час</div>\n        </div>\n    </div>\n    <div class="order-content">\n        <div class="content-header">Описание</div>\n        <div class="content-description">\n            <div>').concat(t,"</div>\n        </div>\n    </div>\n</div>\n    ")},createServiceTotal=function(e,r,t){return'\n      <div class="order-item order-item--service" id="totalOrderID'.concat(t,'">\n        <div class="order-item__name" id="orderServiceName">').concat(e,'</div>\n        <div class="order-item__bar"> </div>\n        <div class="order-item__price" id="orderServicePrice">').concat(r," <span>₽</span></div>\n    </div>\n    ")},updateUserOrderField=function(){var e=document.getElementById("userOrder"),r=document.querySelectorAll(".order-item"),t=document.getElementById("orderTotalPrice").textContent,o="";r.forEach(function(e){var r=e.querySelector(".order-item__name").textContent,e=e.querySelector(".order-item__price").textContent;o="".concat(o," ").concat(r," - ").concat(e,".  ")});t="Всего: ".concat(t);o+=t,e.value=o,console.log(e.value)},updateTotalNumber=function(){var e,r,t;document.querySelectorAll(".order-item__price")?(e=document.querySelectorAll(".order-item__price"),r=document.getElementById("orderTotalPrice"),t=0,e.forEach(function(e){e=parseInt(e.textContent);t+=e}),r.childNodes[0].nodeValue=t+" "):document.getElementById("orderTotalPrice").childNodes[0].nodeValue="0 "},deleteOrderFromLists=function(){var e=document.querySelectorAll(".cross"),n=document.querySelector(".orders-container"),c=document.querySelector(".order-list");e.forEach(function(t){t.addEventListener("click",function(){var o=t.id.replace("cross",""),e=document.getElementById("service".concat(o)),r=document.getElementById("totalOrderID".concat(o));n.removeChild(e),c.removeChild(r),updateTotalNumber(),updateUserOrderField();o=parseInt(o),r=booksArray.filter(function(e,r,t){return(e=e.serviceCounter)!=o});localStorage.setObj("bookedServices",r)})})},bookedItems=localStorage.getObj("bookedServices"),orderContainer=document.querySelector(".orders-container"),orderList=document.querySelector(".order-list"),counter=0,bookedItems.forEach(function(e){var r=e.serviceName,t=e.servicePrice,o=e.serviceDescription,e=e.serviceCounter,o=createServiceOrder(r,t,o,e),e=createServiceTotal(r,t,e);orderContainer.insertAdjacentHTML("beforeend",o),orderList.insertAdjacentHTML("beforeend",e)}),setTimeout(updateTotalNumber,100),setTimeout(deleteOrderFromLists,100),setTimeout(updateUserOrderField,100),$(document).ready(function(){$("#userPhone").inputmask()}));var swiper=new Swiper("#workerSwiper",{direction:"horizontal",loop:!0,speed:400,spaceBetween:34,effect:"cards",slidesPerView:"4"});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFqYXguanMiLCJjb21tb24uanMiLCJzd2lwZXIuanMiXSwibmFtZXMiOlsiaW5wdXRBdXRob3JpemF0aW9uIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImlucHV0Iiwic3BhbiIsInZhbHVlIiwiYWRkV2FybmluZ0VtcHR5U3BhbiIsImNsYXNzTGlzdCIsImFkZCIsImlucHV0SUQiLCJpZCIsInF1ZXJ5U2VsZWN0b3IiLCJjb25jYXQiLCJhcHBlbmRDaGlsZCIsIndhcm5pbmdFbXB0eVNwYW4iLCJjcmVhdGVFbGVtZW50IiwiZGVsZXRlV2FybmluZ1NwYW5zIiwiYWRkRXZlbnRMaXN0ZW5lciIsImlucHV0TGFiZWwiLCJyZW1vdmUiLCJlcmFzZUxvY2FsU3RvcmFnZSIsImxvY2FsU3RvcmFnZSIsInJlbW92ZUl0ZW0iLCIkIiwib24iLCJlIiwicHJldmVudERlZmF1bHQiLCJuYW1lIiwidmFsIiwicGhvbmUiLCJtYWlsIiwib3JkZXIiLCJvcmRlckJ1dHRvbiIsInRleHRDb250ZW50IiwiYWpheCIsInR5cGUiLCJ1cmwiLCJkYXRhIiwiYWN0aW9uIiwic3VjY2VzcyIsInJlc3BvbnNlIiwic2V0VGltZW91dCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsIlN0b3JhZ2UiLCJwcm90b3R5cGUiLCJzZXRPYmoiLCJrZXkiLCJvYmoiLCJ0aGlzIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRPYmoiLCJwYXJzZSIsImdldEl0ZW0iLCJnbG9iYWxDb3VudGVyIiwiY2FyZHNBcnJheSIsImNyZWF0ZUJvb2tpbmdJdGVtIiwiYm9va0J0biIsImNyZWF0ZVNlcnZpY2VPcmRlciIsImNyZWF0ZVNlcnZpY2VUb3RhbCIsInVwZGF0ZVVzZXJPcmRlckZpZWxkIiwidXBkYXRlVG90YWxOdW1iZXIiLCJkZWxldGVPcmRlckZyb21MaXN0cyIsImJvb2tlZEl0ZW1zIiwib3JkZXJDb250YWluZXIiLCJvcmRlckxpc3QiLCJjb3VudGVyIiwiYm9va3NBcnJheSIsIkFycmF5IiwiY2FyZCIsImJhY2tncm91bmQiLCJzdHlsZSIsInJlcGxhY2UiLCJnZXRFbGVtZW50QnlJZCIsInZhbHVlQXNEYXRlIiwiRGF0ZSIsImluY2x1ZGVzIiwic2VydmljZU5hbWUiLCJzZXJ2aWNlUHJpY2UiLCJzZXJ2aWNlRGVzY3JpcHRpb24iLCJib29rT2JqIiwic2VydmljZUNvdW50ZXIiLCJwYXJzZUludCIsInB1c2giLCJwcmljZSIsImRlc2NyaXB0aW9uIiwidXNlck9yZGVyRmllbGQiLCJ1c2VyT3JkZXJMaXN0IiwidG90YWxQcmljZSIsIm9yZGVyU3RyaW5nIiwib3JkZXJOYW1lIiwib3JkZXJQcmljZSIsInRvdGFsU3RyaW5nIiwiY29uc29sZSIsImxvZyIsImFsbE9yZGVyc051bXMiLCJ0b3RhbE51bSIsInRvdGFsU3VtIiwicmVhbFByaWNlIiwiY2hpbGROb2RlcyIsIm5vZGVWYWx1ZSIsImFsbENyb3NzZXMiLCJjcm9zcyIsImNyb3NzQ291bnRlciIsIm9yZGVySXRlbSIsIm9yZGVyVG90YWxJdGVtIiwicmVtb3ZlQ2hpbGQiLCJmaWx0ZXJlZEFycmF5IiwiZmlsdGVyIiwiaW5kZXgiLCJhcnIiLCJyZWFkeU9yZGVyIiwidG90YWxPcmRlciIsImluc2VydEFkamFjZW50SFRNTCIsInJlYWR5IiwiaW5wdXRtYXNrIiwic3dpcGVyIiwiU3dpcGVyIiwiZGlyZWN0aW9uIiwibG9vcCIsInNwZWVkIiwic3BhY2VCZXR3ZWVuIiwiZWZmZWN0Iiwic2xpZGVzUGVyVmlldyJdLCJtYXBwaW5ncyI6ImFBcUNBLFNBQUFBLHFCQUNBQyxTQUFBQyxpQkFBQSxlQUNBQyxRQUFBLFNBQUFDLEdBQ0EsSUFDQUMsRUFEQUQsRUFBQUUsUUFDQUQsRUFBQUUsc0JBQ0FILEVBQUFJLFVBQUFDLElBQUEsdUJBQ0FDLEVBQUFOLEVBQUFPLEdBQ0FWLFNBQUFXLGNBQUEsUUFBQUMsT0FBQUgsRUFBQSxNQUNBSSxZQUFBVCxNQU1BLFNBQUFFLHNCQUNBLElBQUFR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LE9BQUEsSUFBQUMsT0FBQSxnQkFBQSxDQUVBQyxVQUFBLGFBQ0FDLE1BQUEsRUFDQUMsTUFBQSxJQUNBQyxhQUFBLEdBQ0FDLE9BQUEsUUFDQUMsY0FBQSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQUpBWC3Qt9Cw0L/RgNC+0YEg0LTQu9GPINC+0YLQv9GA0LDQstC60Lgg0YHQvtC+0LHRidC10L3QuNC5INC90LAg0L/QvtGH0YLRgywg0LrQvtGC0L7RgNCw0Y8g0YPQutCw0LfQsNC90LAg0LIg0LDQtNC80LjQvdC60LUg0YHQsNC50YLQsFxuJChmdW5jdGlvbiAoKSB7XG4gICAgJChcIiNvcmRlckZvcm1cIikub24oXCJzdWJtaXRcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB2YXIgbmFtZSA9ICQoXCIjdXNlck5hbWVcIikudmFsKCk7XG4gICAgICAgIHZhciBwaG9uZSA9ICQoXCIjdXNlclBob25lXCIpLnZhbCgpO1xuICAgICAgICB2YXIgbWFpbCA9ICQoXCIjdXNlckVtYWlsXCIpLnZhbCgpO1xuICAgICAgICB2YXIgb3JkZXIgPSAkKFwiI3VzZXJPcmRlclwiKS52YWwoKTtcbiAgICAgICAgdmFyIG9yZGVyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9yZGVyLWJ1dHRvbicpO1xuICAgICAgICBvcmRlckJ1dHRvbi50ZXh0Q29udGVudCA9IFwi0J/QvtC00YLQstC10YDQttC00LDQtdC8XCI7XG5cbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHR5cGU6IFwicG9zdFwiLFxuICAgICAgICAgICAgdXJsOiBcIi93cC1hZG1pbi9hZG1pbi1hamF4LnBocFwiLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIGFjdGlvbjogXCJhamF4X2Zvcm1cIixcbiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgICAgIHBob25lOiBwaG9uZSxcbiAgICAgICAgICAgICAgICBtYWlsOiBtYWlsLFxuICAgICAgICAgICAgICAgIG9yZGVyOiBvcmRlcixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBvcmRlckJ1dHRvbi50ZXh0Q29udGVudCA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZXJhc2VMb2NhbFN0b3JhZ2UsIDMwMCk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCJodHRwczovL3Bhcm92b3oueXVyaW4uYml6L3Byb2R1Y3Qvc2luZ2xlLXByb2R1Y3QvXCI7XG4gICAgICAgICAgICAgICAgfSwgMTIwMCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuLy8g0J/RgNC+0LLQtdGA0Y/QtdC8LCDRh9GC0L4g0LLRgdC1INC/0L7Qu9GPINCy0LDQttC90YvQtSDQt9Cw0L/QvtC70L3QtdC90YtcbiQoXCIub3JkZXItYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgIGlucHV0QXV0aG9yaXphdGlvbigpO1xufSk7XG4vLyAgIFxuLy8g0KHQsNC80LAg0YTRg9C90LrRhtC40Y8g0L/RgNC+0LLQtdGA0LrQuCDQv9C+0LvQtdC5INC4INC00L7QsdCw0LLQu9C10L3QuNGPINC00L7Qv9C+0LvQvdC40YLQtdC70YzQvdGL0YUg0YHQstC+0LnRgdGC0LIg0L/QvtC70Y5cbmZ1bmN0aW9uIGlucHV0QXV0aG9yaXphdGlvbigpIHtcbiAgICBjb25zdCBpbnB1dHNBcnJheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZm9ybS1pbnB1dFwiKTtcbiAgICBpbnB1dHNBcnJheS5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgICBpZiAoIWlucHV0LnZhbHVlKSB7XG4gICAgICAgICAgICBjb25zdCBzcGFuID0gYWRkV2FybmluZ0VtcHR5U3BhbigpO1xuICAgICAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZChcImZvcm0taW5wdXQtLXdhcm5pbmdcIik7XG4gICAgICAgICAgICBjb25zdCBpbnB1dElEID0gaW5wdXQuaWQ7XG4gICAgICAgICAgICBjb25zdCBpbnB1dExhYmVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2Zvcj0ke2lucHV0SUR9XWApO1xuICAgICAgICAgICAgaW5wdXRMYWJlbC5hcHBlbmRDaGlsZChzcGFuKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG4vLyDQndC1INGF0L7RgtC10Lsg0L/QtdGA0LXQs9GA0YPQttCw0YLRjCDRhNGD0L3QutGG0LjRjyDQv9GA0L7QstC10YDQutC4INC4INC/0YDQvtGH0LXQtSwg0L/QvtGN0YLQvtC80YMg0YHQvtC30LTQsNC90LjQtSDQvtGC0LTQtdC70YzQvdC+0LPQviDRgdC/0LDQvdCwINCy0YvQvdC10YEg0L7RgtC00LXQu9GM0L3QvlxuZnVuY3Rpb24gYWRkV2FybmluZ0VtcHR5U3BhbigpIHtcbiAgICBjb25zdCB3YXJuaW5nRW1wdHlTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgd2FybmluZ0VtcHR5U3Bhbi5jbGFzc0xpc3QuYWRkKFwiZW1wdHktLWlucHV0XCIpO1xuICAgIHJldHVybiB3YXJuaW5nRW1wdHlTcGFuO1xufVxuLy8g0JrQsNC6INGC0L7Qu9GM0LrQviDQv9C+0LvRjNC30L7QstCw0YLQtdC70Ywg0YDQtdGI0LjQu9GB0Y8g0LLQstC10YHRgtC4INC00LDQvdC90YvQtSwg0LXRgdC70Lgg0LHRi9C70L4g0L/RgNC10LTRg9C/0YDQtdC20LTQtdC90LjQtSDRjyDRg9C00LDQu9GP0Y4g0L/RgNC10LTRg9C/0YDQtdC20LTQtdC90LjRjyDQstGB0Y/QutC40LVcbmZ1bmN0aW9uIGRlbGV0ZVdhcm5pbmdTcGFucygpIHtcbiAgICBjb25zdCBpbnB1dHNBcnJheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZm9ybS1pbnB1dFwiKTtcbiAgICBpbnB1dHNBcnJheS5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW5wdXRJRCA9IGlucHV0LmlkO1xuICAgICAgICAgICAgY29uc3QgaW5wdXRMYWJlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtmb3I9JHtpbnB1dElEfV1gKTtcbiAgICAgICAgICAgIGlmIChpbnB1dExhYmVsLnF1ZXJ5U2VsZWN0b3IoXCIuZW1wdHktLWlucHV0XCIpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2VydGFpblNwYW4gPSBpbnB1dExhYmVsLnF1ZXJ5U2VsZWN0b3IoXCIuZW1wdHktLWlucHV0XCIpO1xuICAgICAgICAgICAgICAgIGNlcnRhaW5TcGFuLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIGlucHV0LmNsYXNzTGlzdC5yZW1vdmUoXCJmb3JtLWlucHV0LS13YXJuaW5nXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuZGVsZXRlV2FybmluZ1NwYW5zKCk7XG5cblxuLy8g0KfQuNGB0YLQuNC8INC70L7QutCw0LvRjNC90L7QtSDRhdGA0LDQvdC40LvQuNGJ0LVcbmZ1bmN0aW9uIGVyYXNlTG9jYWxTdG9yYWdlKCkge1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiZ2xvYmFsQ291bnRlclwiKTtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcImJvb2tlZFNlcnZpY2VzXCIpO1xufVxuIiwiU3RvcmFnZS5wcm90b3R5cGUuc2V0T2JqID0gZnVuY3Rpb24gKGtleSwgb2JqKSB7XG4gIHJldHVybiB0aGlzLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeShvYmopKVxufVxuU3RvcmFnZS5wcm90b3R5cGUuZ2V0T2JqID0gZnVuY3Rpb24gKGtleSkge1xuICByZXR1cm4gSlNPTi5wYXJzZSh0aGlzLmdldEl0ZW0oa2V5KSlcbn1cbnZhciBnbG9iYWxDb3VudGVyID0gMDtcbmlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImdsb2JhbENvdW50ZXJcIikpIHtcbiAgZ2xvYmFsQ291bnRlciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiZ2xvYmFsQ291bnRlclwiKTtcbn1cblxuXG5sZXQgYm9va3NBcnJheSA9IG5ldyBBcnJheSgpO1xuaWYgKGxvY2FsU3RvcmFnZS5nZXRPYmooXCJib29rZWRTZXJ2aWNlc1wiKSkge1xuICBib29rc0FycmF5ID0gbG9jYWxTdG9yYWdlLmdldE9iaihcImJvb2tlZFNlcnZpY2VzXCIpO1xufVxuXG5pZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5hcnRpY2xlLWNhcmRcIikpIHtcbiAgY29uc3QgY2FyZHNBcnJheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYXJ0aWNsZS1jYXJkXCIpO1xuICBjYXJkc0FycmF5LmZvckVhY2goKGNhcmQpID0+IHtcbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgKCkgPT4ge1xuICAgICAgbGV0IGJhY2tncm91bmQgPSBjYXJkLnN0eWxlLmJhY2tncm91bmQ7XG4gICAgICBiYWNrZ3JvdW5kID0gYmFja2dyb3VuZC5yZXBsYWNlKFxuICAgICAgICBcImxpbmVhci1ncmFkaWVudCgzNjBkZWcsIHJnYmEoMjYsIDQ3LCA2OCwgMC45KSAwJSwgcmdiYSgyNiwgNDcsIDY4LCAwKSAxMDAlKVwiLFxuICAgICAgICBcImxpbmVhci1ncmFkaWVudCggMzYwZGVnLCByZ2JhKDIxMiwgMzcsIDIxLCAwLjgpIDAlLCByZ2JhKDIxMiwgMzcsIDIxLCAwKSAxMDAlKVwiXG4gICAgICApO1xuICAgICAgY2FyZC5zdHlsZS5iYWNrZ3JvdW5kID0gYmFja2dyb3VuZDtcbiAgICB9KTtcbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCAoKSA9PiB7XG4gICAgICBsZXQgYmFja2dyb3VuZCA9IGNhcmQuc3R5bGUuYmFja2dyb3VuZDtcbiAgICAgIGJhY2tncm91bmQgPSBiYWNrZ3JvdW5kLnJlcGxhY2UoXG4gICAgICAgIFwibGluZWFyLWdyYWRpZW50KDM2MGRlZywgcmdiYSgyMTIsIDM3LCAyMSwgMC44KSAwJSwgcmdiYSgyMTIsIDM3LCAyMSwgMCkgMTAwJSlcIixcbiAgICAgICAgXCJsaW5lYXItZ3JhZGllbnQoMzYwZGVnLCByZ2JhKDI2LCA0NywgNjgsIDAuOSkgMCUsIHJnYmEoMjYsIDQ3LCA2OCwgMCkgMTAwJSlcIlxuICAgICAgKTtcbiAgICAgIGNhcmQuc3R5bGUuYmFja2dyb3VuZCA9IGJhY2tncm91bmQ7XG4gICAgfSk7XG4gIH0pO1xufVxuaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3JkZXJEYXRlXCIpKSB7XG5cbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29yZGVyRGF0ZScpLnZhbHVlQXNEYXRlID0gbmV3IERhdGUoKTtcbn1cblxuXG5pZiAod2luZG93LmxvY2F0aW9uLmhyZWYuaW5jbHVkZXMoXCJwcm9kdWN0XCIpKSB7XG5cbiAgY29uc3QgYm9va0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2VydmljZS1kYXRhX19ib29rLWJ0blwiKTtcblxuICBib29rQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjcmVhdGVCb29raW5nSXRlbSk7XG5cbiAgZnVuY3Rpb24gY3JlYXRlQm9va2luZ0l0ZW0oKSB7XG4gICAgY29uc3Qgc2VydmljZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNlcnZpY2UtaGVhZGVyXCIpLnRleHRDb250ZW50O1xuICAgIGNvbnN0IHNlcnZpY2VQcmljZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJpY2UtdGFnXCIpLnRleHRDb250ZW50O1xuICAgIGNvbnN0IHNlcnZpY2VEZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGVzY3JpcHRpb24tY29udGVudFwiKS50ZXh0Q29udGVudDtcbiAgICBjb25zdCBib29rT2JqID0ge1xuICAgICAgc2VydmljZUNvdW50ZXI6IHBhcnNlSW50KGdsb2JhbENvdW50ZXIpLFxuICAgICAgc2VydmljZU5hbWU6IHNlcnZpY2VOYW1lLFxuICAgICAgc2VydmljZVByaWNlOiBzZXJ2aWNlUHJpY2UsXG4gICAgICBzZXJ2aWNlRGVzY3JpcHRpb246IHNlcnZpY2VEZXNjcmlwdGlvbixcbiAgICB9XG4gICAgYm9va3NBcnJheS5wdXNoKGJvb2tPYmopO1xuICAgIGxvY2FsU3RvcmFnZS5zZXRPYmooXCJib29rZWRTZXJ2aWNlc1wiLCBib29rc0FycmF5KTtcblxuXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJnbG9iYWxDb3VudGVyXCIsIGdsb2JhbENvdW50ZXIpO1xuICAgIGdsb2JhbENvdW50ZXIrKztcbiAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiYm9va1wiXG5cblxuICB9XG5cbn1cblxuaWYgKHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluY2x1ZGVzKFwiYm9va1wiKSkge1xuICB2YXIgYm9va2VkSXRlbXMgPSBsb2NhbFN0b3JhZ2UuZ2V0T2JqKFwiYm9va2VkU2VydmljZXNcIik7XG4gIHZhciBvcmRlckNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIub3JkZXJzLWNvbnRhaW5lclwiKTtcbiAgdmFyIG9yZGVyTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIub3JkZXItbGlzdFwiKTtcbiAgbGV0IGNvdW50ZXIgPSAwO1xuICBib29rZWRJdGVtcy5mb3JFYWNoKG9yZGVyID0+IHtcbiAgICBjb25zdCBzZXJ2aWNlTmFtZSA9IG9yZGVyLnNlcnZpY2VOYW1lO1xuICAgIGNvbnN0IHNlcnZpY2VQcmljZSA9IG9yZGVyLnNlcnZpY2VQcmljZTtcbiAgICBjb25zdCBzZXJ2aWNlRGVzY3JpcHRpb24gPSBvcmRlci5zZXJ2aWNlRGVzY3JpcHRpb247XG4gICAgY29uc3Qgc2VydmljZUNvdW50ZXIgPSBvcmRlci5zZXJ2aWNlQ291bnRlcjtcblxuICAgIGNvbnN0IHJlYWR5T3JkZXIgPSBjcmVhdGVTZXJ2aWNlT3JkZXIoc2VydmljZU5hbWUsIHNlcnZpY2VQcmljZSwgc2VydmljZURlc2NyaXB0aW9uLCBzZXJ2aWNlQ291bnRlcilcbiAgICBjb25zdCB0b3RhbE9yZGVyID0gY3JlYXRlU2VydmljZVRvdGFsKHNlcnZpY2VOYW1lLCBzZXJ2aWNlUHJpY2UsIHNlcnZpY2VDb3VudGVyKTtcblxuICAgIG9yZGVyQ29udGFpbmVyLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgcmVhZHlPcmRlcik7XG4gICAgb3JkZXJMaXN0Lmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgdG90YWxPcmRlcik7XG4gIH0pXG5cbiAgZnVuY3Rpb24gY3JlYXRlU2VydmljZU9yZGVyKG5hbWUsIHByaWNlLCBkZXNjcmlwdGlvbiwgaWQpIHtcbiAgICBjb25zdCBIVE1MU3RyaW5nID0gYFxuICAgIDxkaXYgY2xhc3M9XCJvcmRlci1jb250YWluZXIgb3JkZXItc2VydmljZVwiIGlkPVwic2VydmljZSR7aWR9XCI+XG4gICAgPGRpdiBjbGFzcz1cImNyb3NzXCIgaWQ9XCJjcm9zcyR7aWR9XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjcm9zcy1vbmVcIj4gPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjcm9zcy10d29cIj48L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwib3JkZXItcm93XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJvcmRlci1pbmZvXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwib3JkZXItaGVhZGVyXCI+JHtuYW1lfTwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm9yZGVyLWNvc3RcIj4ke3ByaWNlfSDigr0gLyDRh9Cw0YE8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cIm9yZGVyLWNvbnRlbnRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbnRlbnQtaGVhZGVyXCI+0J7Qv9C40YHQsNC90LjQtTwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29udGVudC1kZXNjcmlwdGlvblwiPlxuICAgICAgICAgICAgPGRpdj4ke2Rlc2NyaXB0aW9ufTwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbjwvZGl2PlxuICAgIGA7XG4gICAgcmV0dXJuIEhUTUxTdHJpbmc7XG4gIH1cbiAgZnVuY3Rpb24gY3JlYXRlU2VydmljZVRvdGFsKG5hbWUsIHByaWNlLCBpZCkge1xuICAgIGNvbnN0IEhUTUxTdHJpbmcgPVxuICAgICAgYFxuICAgICAgPGRpdiBjbGFzcz1cIm9yZGVyLWl0ZW0gb3JkZXItaXRlbS0tc2VydmljZVwiIGlkPVwidG90YWxPcmRlcklEJHtpZH1cIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm9yZGVyLWl0ZW1fX25hbWVcIiBpZD1cIm9yZGVyU2VydmljZU5hbWVcIj4ke25hbWV9PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJvcmRlci1pdGVtX19iYXJcIj4gPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJvcmRlci1pdGVtX19wcmljZVwiIGlkPVwib3JkZXJTZXJ2aWNlUHJpY2VcIj4ke3ByaWNlfSA8c3Bhbj7igr08L3NwYW4+PC9kaXY+XG4gICAgPC9kaXY+XG4gICAgYDtcbiAgICByZXR1cm4gSFRNTFN0cmluZztcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZVVzZXJPcmRlckZpZWxkKCkge1xuICAgIGNvbnN0IHVzZXJPcmRlckZpZWxkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ1c2VyT3JkZXJcIik7XG4gICAgY29uc3QgdXNlck9yZGVyTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIub3JkZXItaXRlbVwiKTtcbiAgICBjb25zdCB0b3RhbFByaWNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvcmRlclRvdGFsUHJpY2VcIikudGV4dENvbnRlbnQ7XG4gICAgbGV0IG9yZGVyU3RyaW5nID0gJyc7XG4gICAgdXNlck9yZGVyTGlzdC5mb3JFYWNoKG9yZGVyID0+IHtcbiAgICAgIGNvbnN0IG9yZGVyTmFtZSA9IG9yZGVyLnF1ZXJ5U2VsZWN0b3IoXCIub3JkZXItaXRlbV9fbmFtZVwiKS50ZXh0Q29udGVudDtcbiAgICAgIGNvbnN0IG9yZGVyUHJpY2UgPSBvcmRlci5xdWVyeVNlbGVjdG9yKFwiLm9yZGVyLWl0ZW1fX3ByaWNlXCIpLnRleHRDb250ZW50O1xuICAgICAgb3JkZXJTdHJpbmcgPSBgJHtvcmRlclN0cmluZ30gJHtvcmRlck5hbWV9IC0gJHtvcmRlclByaWNlfS4gIGBcbiAgICB9KTtcbiAgICBsZXQgdG90YWxTdHJpbmcgPSBg0JLRgdC10LPQvjogJHt0b3RhbFByaWNlfWA7XG4gICAgb3JkZXJTdHJpbmcgKz0gdG90YWxTdHJpbmc7XG4gICAgdXNlck9yZGVyRmllbGQudmFsdWUgPSBvcmRlclN0cmluZztcbiAgICBjb25zb2xlLmxvZyh1c2VyT3JkZXJGaWVsZC52YWx1ZSk7XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGVUb3RhbE51bWJlcigpIHtcbiAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5vcmRlci1pdGVtX19wcmljZVwiKSkge1xuICAgICAgY29uc3QgYWxsT3JkZXJzTnVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIub3JkZXItaXRlbV9fcHJpY2VcIik7XG4gICAgICBjb25zdCB0b3RhbE51bSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3JkZXJUb3RhbFByaWNlXCIpO1xuICAgICAgbGV0IHRvdGFsU3VtID0gMDtcbiAgICAgIGFsbE9yZGVyc051bXMuZm9yRWFjaChwcmljZSA9PiB7XG4gICAgICAgIHZhciByZWFsUHJpY2UgPSBwYXJzZUludChwcmljZS50ZXh0Q29udGVudClcbiAgICAgICAgdG90YWxTdW0gKz0gcmVhbFByaWNlO1xuICAgICAgfSlcbiAgICAgIGxldCB0b3RhbE51bUZpbmFsID0gdG90YWxOdW0uY2hpbGROb2Rlc1swXTtcbiAgICAgIHRvdGFsTnVtRmluYWwubm9kZVZhbHVlID0gdG90YWxTdW0gKyAnICc7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgY29uc3QgdG90YWxOdW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm9yZGVyVG90YWxQcmljZVwiKTtcbiAgICAgIGxldCB0b3RhbFN1bSA9IDA7XG4gICAgICBsZXQgdG90YWxOdW1GaW5hbCA9IHRvdGFsTnVtLmNoaWxkTm9kZXNbMF07XG4gICAgICB0b3RhbE51bUZpbmFsLm5vZGVWYWx1ZSA9IHRvdGFsU3VtICsgJyAnO1xuICAgIH1cbiAgfVxuICBzZXRUaW1lb3V0KHVwZGF0ZVRvdGFsTnVtYmVyLCAxMDApXG4gIHNldFRpbWVvdXQoZGVsZXRlT3JkZXJGcm9tTGlzdHMsIDEwMClcbiAgc2V0VGltZW91dCh1cGRhdGVVc2VyT3JkZXJGaWVsZCwgMTAwKVxuXG4gIGZ1bmN0aW9uIGRlbGV0ZU9yZGVyRnJvbUxpc3RzKCkge1xuICAgIGNvbnN0IGFsbENyb3NzZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmNyb3NzXCIpO1xuICAgIHZhciBvcmRlckNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIub3JkZXJzLWNvbnRhaW5lclwiKTtcbiAgICB2YXIgb3JkZXJMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5vcmRlci1saXN0XCIpO1xuICAgIGFsbENyb3NzZXMuZm9yRWFjaChjcm9zcyA9PiB7XG4gICAgICBjcm9zcy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICBsZXQgY3Jvc3NDb3VudGVyID0gY3Jvc3MuaWQucmVwbGFjZSgnY3Jvc3MnLCAnJyk7XG5cbiAgICAgICAgY29uc3Qgb3JkZXJJdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHNlcnZpY2Uke2Nyb3NzQ291bnRlcn1gKTtcbiAgICAgICAgY29uc3Qgb3JkZXJUb3RhbEl0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgdG90YWxPcmRlcklEJHtjcm9zc0NvdW50ZXJ9YCk7XG4gICAgICAgIG9yZGVyQ29udGFpbmVyLnJlbW92ZUNoaWxkKG9yZGVySXRlbSk7XG4gICAgICAgIG9yZGVyTGlzdC5yZW1vdmVDaGlsZChvcmRlclRvdGFsSXRlbSk7XG4gICAgICAgIHVwZGF0ZVRvdGFsTnVtYmVyKCk7XG4gICAgICAgIHVwZGF0ZVVzZXJPcmRlckZpZWxkKClcblxuICAgICAgICBjcm9zc0NvdW50ZXIgPSBwYXJzZUludChjcm9zc0NvdW50ZXIpO1xuICAgICAgICB2YXIgZmlsdGVyZWRBcnJheSA9IGJvb2tzQXJyYXkuZmlsdGVyKGZ1bmN0aW9uICh2YWx1ZSwgaW5kZXgsIGFycikge1xuICAgICAgICAgIHZhbHVlID0gdmFsdWUuc2VydmljZUNvdW50ZXI7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlICE9IGNyb3NzQ291bnRlcjtcbiAgICAgICAgfSk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRPYmooXCJib29rZWRTZXJ2aWNlc1wiLCBmaWx0ZXJlZEFycmF5KTtcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgJChcIiN1c2VyUGhvbmVcIikuaW5wdXRtYXNrKCk7XG4gIH0pO1xuXG59XG4iLCJjb25zdCBzd2lwZXIgPSBuZXcgU3dpcGVyKCcjd29ya2VyU3dpcGVyJywge1xuICAgIC8vIE9wdGlvbmFsIHBhcmFtZXRlcnNcbiAgICBkaXJlY3Rpb246ICdob3Jpem9udGFsJyxcbiAgICBsb29wOiB0cnVlLFxuICAgIHNwZWVkOiA0MDAsXG4gICAgc3BhY2VCZXR3ZWVuOiAzNCxcbiAgICBlZmZlY3Q6ICdjYXJkcycsXG4gICAgc2xpZGVzUGVyVmlldzogJzQnXG59KTsiXX0=
