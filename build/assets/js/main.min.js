"use strict";function inputAuthorization(){document.querySelectorAll(".form-input").forEach(function(e){var r;e.value||(r=addWarningEmptySpan(),e.classList.add("form-input--warning"),e=e.id,document.querySelector("[for=".concat(e,"]")).appendChild(r))})}function addWarningEmptySpan(){var e=document.createElement("span");return e.classList.add("empty--input"),e}function deleteWarningSpans(){document.querySelectorAll(".form-input").forEach(function(r){r.addEventListener("input",function(){var e=r.id,e=document.querySelector("[for=".concat(e,"]"));e.querySelector(".empty--input")&&(e.querySelector(".empty--input").remove(),r.classList.remove("form-input--warning"))})})}function eraseLocalStorage(){localStorage.removeItem("globalCounter"),localStorage.removeItem("bookedServices")}$(function(){$("#orderForm").on("submit",function(e){e.preventDefault();var r=$("#userName").val(),t=$("#userPhone").val(),o=$("#userEmail").val(),e=$("#userOrder").val(),n=document.querySelector(".order-button");n.textContent="Подтверждаем",$.ajax({type:"post",url:"/wp-admin/admin-ajax.php",data:{action:"ajax_form",name:r,phone:t,mail:o,order:e},success:function(e){n.textContent=e,setTimeout(eraseLocalStorage,300),setTimeout(function(){window.location.href="https://parovoz.yurin.biz/product/single-product/"},1200)}})})}),$(".order-button").on("click",function(){inputAuthorization()}),deleteWarningSpans(),Storage.prototype.setObj=function(e,r){return this.setItem(e,JSON.stringify(r))},Storage.prototype.getObj=function(e){return JSON.parse(this.getItem(e))};var globalCounter=0;localStorage.getItem("globalCounter")&&(globalCounter=localStorage.getItem("globalCounter"));var cardsArray,createBookingItem,bookBtn,createServiceOrder,createServiceTotal,updateUserOrderField,updateTotalNumber,deleteOrderFromLists,bookedItems,orderContainer,orderList,counter,booksArray=new Array;localStorage.getObj("bookedServices")&&(booksArray=localStorage.getObj("bookedServices")),document.querySelector(".article-card")&&(cardsArray=document.querySelectorAll(".article-card")).forEach(function(r){r.addEventListener("mouseover",function(){var e=(e=r.style.background).replace("linear-gradient(360deg, rgba(26, 47, 68, 0.9) 0%, rgba(26, 47, 68, 0) 100%)","linear-gradient( 360deg, rgba(212, 37, 21, 0.8) 0%, rgba(212, 37, 21, 0) 100%)");r.style.background=e}),r.addEventListener("mouseout",function(){var e=(e=r.style.background).replace("linear-gradient(360deg, rgba(212, 37, 21, 0.8) 0%, rgba(212, 37, 21, 0) 100%)","linear-gradient(360deg, rgba(26, 47, 68, 0.9) 0%, rgba(26, 47, 68, 0) 100%)");r.style.background=e})}),document.getElementById("orderDate")&&(document.getElementById("orderDate").valueAsDate=new Date),window.location.href.includes("product")&&(createBookingItem=function(){var e=document.querySelector(".service-header").textContent,r=document.querySelector(".price-tag").textContent,t=document.querySelector(".description-content").textContent,t={serviceCounter:parseInt(globalCounter),serviceName:e,servicePrice:r,serviceDescription:t};booksArray.push(t),localStorage.setObj("bookedServices",booksArray),localStorage.setItem("globalCounter",globalCounter),globalCounter++,window.location.href="book"},(bookBtn=document.querySelector(".service-data__book-btn")).addEventListener("click",createBookingItem)),window.location.href.includes("book")&&(createServiceOrder=function(e,r,t,o){return'\n    <div class="order-container order-service" id="service'.concat(o,'">\n    <div class="cross" id="cross').concat(o,'">\n        <div class="cross-one"> </div>\n        <div class="cross-two"></div>\n    </div>\n    <div class="order-row">\n        <div class="order-info">\n            <div class="order-header">').concat(e,'</div>\n            <div class="order-cost">').concat(r,' ₽ / час</div>\n        </div>\n    </div>\n    <div class="order-content">\n        <div class="content-header">Описание</div>\n        <div class="content-description">\n            <div>').concat(t,"</div>\n        </div>\n    </div>\n</div>\n    ")},createServiceTotal=function(e,r,t){return'\n      <div class="order-item order-item--service" id="totalOrderID'.concat(t,'">\n        <div class="order-item__name" id="orderServiceName">').concat(e,'</div>\n        <div class="order-item__bar"> </div>\n        <div class="order-item__price" id="orderServicePrice">').concat(r," <span>₽</span></div>\n    </div>\n    ")},updateUserOrderField=function(){var e=document.getElementById("userOrder"),r=document.querySelectorAll(".order-item"),t=document.getElementById("orderTotalPrice").textContent,o="";r.forEach(function(e){var r=e.querySelector(".order-item__name").textContent,e=e.querySelector(".order-item__price").textContent;o="".concat(o," ").concat(r," - ").concat(e,".  ")});t="Всего: ".concat(t);o+=t,e.value=o,console.log(e.value)},updateTotalNumber=function(){var e,r,t;document.querySelectorAll(".order-item__price")?(e=document.querySelectorAll(".order-item__price"),r=document.getElementById("orderTotalPrice"),t=0,e.forEach(function(e){e=parseInt(e.textContent);t+=e}),r.childNodes[0].nodeValue=t+" "):document.getElementById("orderTotalPrice").childNodes[0].nodeValue="0 "},deleteOrderFromLists=function(){var e=document.querySelectorAll(".cross"),n=document.querySelector(".orders-container"),c=document.querySelector(".order-list");e.forEach(function(t){t.addEventListener("click",function(){var o=t.id.replace("cross",""),e=document.getElementById("service".concat(o)),r=document.getElementById("totalOrderID".concat(o));n.removeChild(e),c.removeChild(r),updateTotalNumber(),updateUserOrderField();o=parseInt(o),r=booksArray.filter(function(e,r,t){return(e=e.serviceCounter)!=o});localStorage.setObj("bookedServices",r)})})},bookedItems=localStorage.getObj("bookedServices"),orderContainer=document.querySelector(".orders-container"),orderList=document.querySelector(".order-list"),counter=0,bookedItems.forEach(function(e){var r=e.serviceName,t=e.servicePrice,o=e.serviceDescription,e=e.serviceCounter,o=createServiceOrder(r,t,o,e),e=createServiceTotal(r,t,e);orderContainer.insertAdjacentHTML("beforeend",o),orderList.insertAdjacentHTML("beforeend",e)}),setTimeout(updateTotalNumber,100),setTimeout(deleteOrderFromLists,100),setTimeout(updateUserOrderField,100),$(document).ready(function(){$("#userPhone").inputmask()}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFqYXguanMiLCJjb21tb24uanMiXSwibmFtZXMiOlsiaW5wdXRBdXRob3JpemF0aW9uIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImlucHV0Iiwic3BhbiIsInZhbHVlIiwiYWRkV2FybmluZ0VtcHR5U3BhbiIsImNsYXNzTGlzdCIsImFkZCIsImlucHV0SUQiLCJpZCIsInF1ZXJ5U2VsZWN0b3IiLCJjb25jYXQiLCJhcHBlbmRDaGlsZCIsIndhcm5pbmdFbXB0eVNwYW4iLCJjcmVhdGVFbGVtZW50IiwiZGVsZXRlV2FybmluZ1NwYW5zIiwiYWRkRXZlbnRMaXN0ZW5lciIsImlucHV0TGFiZWwiLCJyZW1vdmUiLCJlcmFzZUxvY2FsU3RvcmFnZSIsImxvY2FsU3RvcmFnZSIsInJlbW92ZUl0ZW0iLCIkIiwib24iLCJlIiwicHJldmVudERlZmF1bHQiLCJuYW1lIiwidmFsIiwicGhvbmUiLCJtYWlsIiwib3JkZXIiLCJvcmRlckJ1dHRvbiIsInRleHRDb250ZW50IiwiYWpheCIsInR5cGUiLCJ1cmwiLCJkYXRhIiwiYWN0aW9uIiwic3VjY2VzcyIsInJlc3BvbnNlIiwic2V0VGltZW91dCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsIlN0b3JhZ2UiLCJwcm90b3R5cGUiLCJzZXRPYmoiLCJrZXkiLCJvYmoiLCJ0aGlzIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRPYmoiLCJwYXJzZSIsImdldEl0ZW0iLCJnbG9iYWxDb3VudGVyIiwiY2FyZHNBcnJheSIsImNyZWF0ZUJvb2tpbmdJdGVtIiwiYm9va0J0biIsImNyZWF0ZVNlcnZpY2VPcmRlciIsImNyZWF0ZVNlcnZpY2VUb3RhbCIsInVwZGF0ZVVzZXJPcmRlckZpZWxkIiwidXBkYXRlVG90YWxOdW1iZXIiLCJkZWxldGVPcmRlckZyb21MaXN0cyIsImJvb2tlZEl0ZW1zIiwib3JkZXJDb250YWluZXIiLCJvcmRlckxpc3QiLCJjb3VudGVyIiwiYm9va3NBcnJheSIsIkFycmF5IiwiY2FyZCIsImJhY2tncm91bmQiLCJzdHlsZSIsInJlcGxhY2UiLCJnZXRFbGVtZW50QnlJZCIsInZhbHVlQXNEYXRlIiwiRGF0ZSIsImluY2x1ZGVzIiwic2VydmljZU5hbWUiLCJzZXJ2aWNlUHJpY2UiLCJzZXJ2aWNlRGVzY3JpcHRpb24iLCJib29rT2JqIiwic2VydmljZUNvdW50ZXIiLCJwYXJzZUludCIsInB1c2giLCJwcmljZSIsImRlc2NyaXB0aW9uIiwidXNlck9yZGVyRmllbGQiLCJ1c2VyT3JkZXJMaXN0IiwidG90YWxQcmljZSIsIm9yZGVyU3RyaW5nIiwib3JkZXJOYW1lIiwib3JkZXJQcmljZSIsInRvdGFsU3RyaW5nIiwiY29uc29sZSIsImxvZyIsImFsbE9yZGVyc051bXMiLCJ0b3RhbE51bSIsInRvdGFsU3VtIiwicmVhbFByaWNlIiwiY2hpbGROb2RlcyIsIm5vZGVWYWx1ZSIsImFsbENyb3NzZXMiLCJjcm9zcyIsImNyb3NzQ291bnRlciIsIm9yZGVySXRlbSIsIm9yZGVyVG90YWxJdGVtIiwicmVtb3ZlQ2hpbGQiLCJmaWx0ZXJlZEFycmF5IiwiZmlsdGVyIiwiaW5kZXgiLCJhcnIiLCJyZWFkeU9yZGVyIiwidG90YWxPcmRlciIsImluc2VydEFkamFjZW50SFRNTCIsInJlYWR5IiwiaW5wdXRtYXNrIl0sIm1hcHBpbmdzIjoiYUFxQ0EsU0FBQUEscUJBQ0FDLFNBQUFDLGlCQUFBLGVBQ0FDLFFBQUEsU0FBQUMsR0FDQSxJQUNBQyxFQURBRCxFQUFBRSxRQUNBRCxFQUFBRSxzQkFDQUgsRUFBQUksVUFBQUMsSUFBQSx1QkFDQUMsRUFBQU4sRUFBQU8sR0FDQVYsU0FBQVcsY0FBQSxRQUFBQyxPQUFBSCxFQUFBLE1BQ0FJLFlBQUFULE1BTUEsU0FBQUUsc0JBQ0EsSUFBQVEsRUFBQWQsU0FBQWUsY0FBQSxRQUVBLE9BREFELEVBQUFQLFVBQUFDLElBQUEsZ0JBQ0FNLEVBR0EsU0FBQUUscUJBQ0FoQixTQUFBQyxpQkFBQSxlQUNBQyxRQUFBLFNB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Y0FBQSxlQUNBNkYsRUFBQXRHLFFBQUEsU0FBQXVHLEdBQ0FBLEVBQUF4RixpQkFBQSxRQUFBLFdBQ0EsSUFBQXlGLEVBQUFELEVBQUEvRixHQUFBaUUsUUFBQSxRQUFBLElBRUFnQyxFQUFBM0csU0FBQTRFLGVBQUEsVUFBQWhFLE9BQUE4RixJQUNBRSxFQUFBNUcsU0FBQTRFLGVBQUEsZUFBQWhFLE9BQUE4RixJQUNBdkMsRUFBQTBDLFlBQUFGLEdBQ0F2QyxFQUFBeUMsWUFBQUQsR0FDQTVDLG9CQUNBRCx1QkFFQTJDLEVBQUFyQixTQUFBcUIsR0FDQUksRUFBQXhDLFdBQUF5QyxPQUFBLFNBQUExRyxFQUFBMkcsRUFBQUMsR0FFQSxPQURBNUcsRUFBQUEsRUFBQStFLGlCQUNBc0IsSUFFQXJGLGFBQUEwQixPQUFBLGlCQUFBK0QsUUEvR0E1QyxZQUFBN0MsYUFBQWlDLE9BQUEsa0JBQ0FhLGVBQUFuRSxTQUFBVyxjQUFBLHFCQUNBeUQsVUFBQXBFLFNBQUFXLGNBQUEsZUFDQTBELFFBQUEsRUFDQUgsWUFBQWhFLFFBQUEsU0FBQTZCLEdBQ0EsSUFBQWlELEVBQUFqRCxFQUFBaUQsWUFDQUMsRUFBQWxELEVBQUFrRCxhQUNBQyxFQUFBbkQsRUFBQW1ELG1CQUNBRSxFQUFBckQsRUFBQXFELGVBRUE4QixFQUFBckQsbUJBQUFtQixFQUFBQyxFQUFBQyxFQUFBRSxHQUNBK0IsRUFBQXJELG1CQUFBa0IsRUFBQUMsRUFBQUcsR0FFQWpCLGVBQUFpRCxtQkFBQSxZQUFBRixHQUNBOUMsVUFBQWdELG1CQUFBLFlBQUFELEtBeUVBMUUsV0FBQXVCLGtCQUFBLEtBQ0F2QixXQUFBd0IscUJBQUEsS0FDQXhCLFdBQUFzQixxQkFBQSxLQTBCQXhDLEVBQUF2QixVQUFBcUgsTUFBQSxXQUNBOUYsRUFBQSxjQUFBK0YiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEFKQVgt0LfQsNC/0YDQvtGBINC00LvRjyDQvtGC0L/RgNCw0LLQutC4INGB0L7QvtCx0YnQtdC90LjQuSDQvdCwINC/0L7Rh9GC0YMsINC60L7RgtC+0YDQsNGPINGD0LrQsNC30LDQvdCwINCyINCw0LTQvNC40L3QutC1INGB0LDQudGC0LBcbiQoZnVuY3Rpb24gKCkge1xuICAgICQoXCIjb3JkZXJGb3JtXCIpLm9uKFwic3VibWl0XCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyIG5hbWUgPSAkKFwiI3VzZXJOYW1lXCIpLnZhbCgpO1xuICAgICAgICB2YXIgcGhvbmUgPSAkKFwiI3VzZXJQaG9uZVwiKS52YWwoKTtcbiAgICAgICAgdmFyIG1haWwgPSAkKFwiI3VzZXJFbWFpbFwiKS52YWwoKTtcbiAgICAgICAgdmFyIG9yZGVyID0gJChcIiN1c2VyT3JkZXJcIikudmFsKCk7XG4gICAgICAgIHZhciBvcmRlckJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vcmRlci1idXR0b24nKTtcbiAgICAgICAgb3JkZXJCdXR0b24udGV4dENvbnRlbnQgPSBcItCf0L7QtNGC0LLQtdGA0LbQtNCw0LXQvFwiO1xuXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB0eXBlOiBcInBvc3RcIixcbiAgICAgICAgICAgIHVybDogXCIvd3AtYWRtaW4vYWRtaW4tYWpheC5waHBcIixcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBhY3Rpb246IFwiYWpheF9mb3JtXCIsXG4gICAgICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgICAgICBwaG9uZTogcGhvbmUsXG4gICAgICAgICAgICAgICAgbWFpbDogbWFpbCxcbiAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgb3JkZXJCdXR0b24udGV4dENvbnRlbnQgPSByZXNwb25zZTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGVyYXNlTG9jYWxTdG9yYWdlLCAzMDApO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiaHR0cHM6Ly9wYXJvdm96Lnl1cmluLmJpei9wcm9kdWN0L3NpbmdsZS1wcm9kdWN0L1wiO1xuICAgICAgICAgICAgICAgIH0sIDEyMDApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbi8vINCf0YDQvtCy0LXRgNGP0LXQvCwg0YfRgtC+INCy0YHQtSDQv9C+0LvRjyDQstCw0LbQvdGL0LUg0LfQsNC/0L7Qu9C90LXQvdGLXG4kKFwiLm9yZGVyLWJ1dHRvblwiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBpbnB1dEF1dGhvcml6YXRpb24oKTtcbn0pO1xuLy8gICBcbi8vINCh0LDQvNCwINGE0YPQvdC60YbQuNGPINC/0YDQvtCy0LXRgNC60Lgg0L/QvtC70LXQuSDQuCDQtNC+0LHQsNCy0LvQtdC90LjRjyDQtNC+0L/QvtC70L3QuNGC0LXQu9GM0L3Ri9GFINGB0LLQvtC50YHRgtCyINC/0L7Qu9GOXG5mdW5jdGlvbiBpbnB1dEF1dGhvcml6YXRpb24oKSB7XG4gICAgY29uc3QgaW5wdXRzQXJyYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmZvcm0taW5wdXRcIik7XG4gICAgaW5wdXRzQXJyYXkuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgICAgaWYgKCFpbnB1dC52YWx1ZSkge1xuICAgICAgICAgICAgY29uc3Qgc3BhbiA9IGFkZFdhcm5pbmdFbXB0eVNwYW4oKTtcbiAgICAgICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoXCJmb3JtLWlucHV0LS13YXJuaW5nXCIpO1xuICAgICAgICAgICAgY29uc3QgaW5wdXRJRCA9IGlucHV0LmlkO1xuICAgICAgICAgICAgY29uc3QgaW5wdXRMYWJlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtmb3I9JHtpbnB1dElEfV1gKTtcbiAgICAgICAgICAgIGlucHV0TGFiZWwuYXBwZW5kQ2hpbGQoc3Bhbik7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuLy8g0J3QtSDRhdC+0YLQtdC7INC/0LXRgNC10LPRgNGD0LbQsNGC0Ywg0YTRg9C90LrRhtC40Y8g0L/RgNC+0LLQtdGA0LrQuCDQuCDQv9GA0L7Rh9C10LUsINC/0L7RjdGC0L7QvNGDINGB0L7Qt9C00LDQvdC40LUg0L7RgtC00LXQu9GM0L3QvtCz0L4g0YHQv9Cw0L3QsCDQstGL0L3QtdGBINC+0YLQtNC10LvRjNC90L5cbmZ1bmN0aW9uIGFkZFdhcm5pbmdFbXB0eVNwYW4oKSB7XG4gICAgY29uc3Qgd2FybmluZ0VtcHR5U3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgIHdhcm5pbmdFbXB0eVNwYW4uY2xhc3NMaXN0LmFkZChcImVtcHR5LS1pbnB1dFwiKTtcbiAgICByZXR1cm4gd2FybmluZ0VtcHR5U3Bhbjtcbn1cbi8vINCa0LDQuiDRgtC+0LvRjNC60L4g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GMINGA0LXRiNC40LvRgdGPINCy0LLQtdGB0YLQuCDQtNCw0L3QvdGL0LUsINC10YHQu9C4INCx0YvQu9C+INC/0YDQtdC00YPQv9GA0LXQttC00LXQvdC40LUg0Y8g0YPQtNCw0LvRj9GOINC/0YDQtdC00YPQv9GA0LXQttC00LXQvdC40Y8g0LLRgdGP0LrQuNC1XG5mdW5jdGlvbiBkZWxldGVXYXJuaW5nU3BhbnMoKSB7XG4gICAgY29uc3QgaW5wdXRzQXJyYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmZvcm0taW5wdXRcIik7XG4gICAgaW5wdXRzQXJyYXkuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGlucHV0SUQgPSBpbnB1dC5pZDtcbiAgICAgICAgICAgIGNvbnN0IGlucHV0TGFiZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZm9yPSR7aW5wdXRJRH1dYCk7XG4gICAgICAgICAgICBpZiAoaW5wdXRMYWJlbC5xdWVyeVNlbGVjdG9yKFwiLmVtcHR5LS1pbnB1dFwiKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNlcnRhaW5TcGFuID0gaW5wdXRMYWJlbC5xdWVyeVNlbGVjdG9yKFwiLmVtcHR5LS1pbnB1dFwiKTtcbiAgICAgICAgICAgICAgICBjZXJ0YWluU3Bhbi5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKFwiZm9ybS1pbnB1dC0td2FybmluZ1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5cbmRlbGV0ZVdhcm5pbmdTcGFucygpO1xuXG5cbi8vINCn0LjRgdGC0LjQvCDQu9C+0LrQsNC70YzQvdC+0LUg0YXRgNCw0L3QuNC70LjRidC1XG5mdW5jdGlvbiBlcmFzZUxvY2FsU3RvcmFnZSgpIHtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcImdsb2JhbENvdW50ZXJcIik7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJib29rZWRTZXJ2aWNlc1wiKTtcbn1cbiIsIlN0b3JhZ2UucHJvdG90eXBlLnNldE9iaiA9IGZ1bmN0aW9uIChrZXksIG9iaikge1xuICByZXR1cm4gdGhpcy5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkob2JqKSlcbn1cblN0b3JhZ2UucHJvdG90eXBlLmdldE9iaiA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgcmV0dXJuIEpTT04ucGFyc2UodGhpcy5nZXRJdGVtKGtleSkpXG59XG52YXIgZ2xvYmFsQ291bnRlciA9IDA7XG5pZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJnbG9iYWxDb3VudGVyXCIpKSB7XG4gIGdsb2JhbENvdW50ZXIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImdsb2JhbENvdW50ZXJcIik7XG59XG5cblxubGV0IGJvb2tzQXJyYXkgPSBuZXcgQXJyYXkoKTtcbmlmIChsb2NhbFN0b3JhZ2UuZ2V0T2JqKFwiYm9va2VkU2VydmljZXNcIikpIHtcbiAgYm9va3NBcnJheSA9IGxvY2FsU3RvcmFnZS5nZXRPYmooXCJib29rZWRTZXJ2aWNlc1wiKTtcbn1cblxuaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYXJ0aWNsZS1jYXJkXCIpKSB7XG4gIGNvbnN0IGNhcmRzQXJyYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmFydGljbGUtY2FyZFwiKTtcbiAgY2FyZHNBcnJheS5mb3JFYWNoKChjYXJkKSA9PiB7XG4gICAgY2FyZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsICgpID0+IHtcbiAgICAgIGxldCBiYWNrZ3JvdW5kID0gY2FyZC5zdHlsZS5iYWNrZ3JvdW5kO1xuICAgICAgYmFja2dyb3VuZCA9IGJhY2tncm91bmQucmVwbGFjZShcbiAgICAgICAgXCJsaW5lYXItZ3JhZGllbnQoMzYwZGVnLCByZ2JhKDI2LCA0NywgNjgsIDAuOSkgMCUsIHJnYmEoMjYsIDQ3LCA2OCwgMCkgMTAwJSlcIixcbiAgICAgICAgXCJsaW5lYXItZ3JhZGllbnQoIDM2MGRlZywgcmdiYSgyMTIsIDM3LCAyMSwgMC44KSAwJSwgcmdiYSgyMTIsIDM3LCAyMSwgMCkgMTAwJSlcIlxuICAgICAgKTtcbiAgICAgIGNhcmQuc3R5bGUuYmFja2dyb3VuZCA9IGJhY2tncm91bmQ7XG4gICAgfSk7XG4gICAgY2FyZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgKCkgPT4ge1xuICAgICAgbGV0IGJhY2tncm91bmQgPSBjYXJkLnN0eWxlLmJhY2tncm91bmQ7XG4gICAgICBiYWNrZ3JvdW5kID0gYmFja2dyb3VuZC5yZXBsYWNlKFxuICAgICAgICBcImxpbmVhci1ncmFkaWVudCgzNjBkZWcsIHJnYmEoMjEyLCAzNywgMjEsIDAuOCkgMCUsIHJnYmEoMjEyLCAzNywgMjEsIDApIDEwMCUpXCIsXG4gICAgICAgIFwibGluZWFyLWdyYWRpZW50KDM2MGRlZywgcmdiYSgyNiwgNDcsIDY4LCAwLjkpIDAlLCByZ2JhKDI2LCA0NywgNjgsIDApIDEwMCUpXCJcbiAgICAgICk7XG4gICAgICBjYXJkLnN0eWxlLmJhY2tncm91bmQgPSBiYWNrZ3JvdW5kO1xuICAgIH0pO1xuICB9KTtcbn1cbmlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm9yZGVyRGF0ZVwiKSkge1xuXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcmRlckRhdGUnKS52YWx1ZUFzRGF0ZSA9IG5ldyBEYXRlKCk7XG59XG5cblxuaWYgKHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluY2x1ZGVzKFwicHJvZHVjdFwiKSkge1xuXG4gIGNvbnN0IGJvb2tCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNlcnZpY2UtZGF0YV9fYm9vay1idG5cIik7XG5cbiAgYm9va0J0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY3JlYXRlQm9va2luZ0l0ZW0pO1xuXG4gIGZ1bmN0aW9uIGNyZWF0ZUJvb2tpbmdJdGVtKCkge1xuICAgIGNvbnN0IHNlcnZpY2VOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zZXJ2aWNlLWhlYWRlclwiKS50ZXh0Q29udGVudDtcbiAgICBjb25zdCBzZXJ2aWNlUHJpY2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByaWNlLXRhZ1wiKS50ZXh0Q29udGVudDtcbiAgICBjb25zdCBzZXJ2aWNlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRlc2NyaXB0aW9uLWNvbnRlbnRcIikudGV4dENvbnRlbnQ7XG4gICAgY29uc3QgYm9va09iaiA9IHtcbiAgICAgIHNlcnZpY2VDb3VudGVyOiBwYXJzZUludChnbG9iYWxDb3VudGVyKSxcbiAgICAgIHNlcnZpY2VOYW1lOiBzZXJ2aWNlTmFtZSxcbiAgICAgIHNlcnZpY2VQcmljZTogc2VydmljZVByaWNlLFxuICAgICAgc2VydmljZURlc2NyaXB0aW9uOiBzZXJ2aWNlRGVzY3JpcHRpb24sXG4gICAgfVxuICAgIGJvb2tzQXJyYXkucHVzaChib29rT2JqKTtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0T2JqKFwiYm9va2VkU2VydmljZXNcIiwgYm9va3NBcnJheSk7XG5cblxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiZ2xvYmFsQ291bnRlclwiLCBnbG9iYWxDb3VudGVyKTtcbiAgICBnbG9iYWxDb3VudGVyKys7XG4gICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcImJvb2tcIlxuXG5cbiAgfVxuXG59XG5cbmlmICh3aW5kb3cubG9jYXRpb24uaHJlZi5pbmNsdWRlcyhcImJvb2tcIikpIHtcbiAgdmFyIGJvb2tlZEl0ZW1zID0gbG9jYWxTdG9yYWdlLmdldE9iaihcImJvb2tlZFNlcnZpY2VzXCIpO1xuICB2YXIgb3JkZXJDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm9yZGVycy1jb250YWluZXJcIik7XG4gIHZhciBvcmRlckxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm9yZGVyLWxpc3RcIik7XG4gIGxldCBjb3VudGVyID0gMDtcbiAgYm9va2VkSXRlbXMuZm9yRWFjaChvcmRlciA9PiB7XG4gICAgY29uc3Qgc2VydmljZU5hbWUgPSBvcmRlci5zZXJ2aWNlTmFtZTtcbiAgICBjb25zdCBzZXJ2aWNlUHJpY2UgPSBvcmRlci5zZXJ2aWNlUHJpY2U7XG4gICAgY29uc3Qgc2VydmljZURlc2NyaXB0aW9uID0gb3JkZXIuc2VydmljZURlc2NyaXB0aW9uO1xuICAgIGNvbnN0IHNlcnZpY2VDb3VudGVyID0gb3JkZXIuc2VydmljZUNvdW50ZXI7XG5cbiAgICBjb25zdCByZWFkeU9yZGVyID0gY3JlYXRlU2VydmljZU9yZGVyKHNlcnZpY2VOYW1lLCBzZXJ2aWNlUHJpY2UsIHNlcnZpY2VEZXNjcmlwdGlvbiwgc2VydmljZUNvdW50ZXIpXG4gICAgY29uc3QgdG90YWxPcmRlciA9IGNyZWF0ZVNlcnZpY2VUb3RhbChzZXJ2aWNlTmFtZSwgc2VydmljZVByaWNlLCBzZXJ2aWNlQ291bnRlcik7XG5cbiAgICBvcmRlckNvbnRhaW5lci5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIHJlYWR5T3JkZXIpO1xuICAgIG9yZGVyTGlzdC5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIHRvdGFsT3JkZXIpO1xuICB9KVxuXG4gIGZ1bmN0aW9uIGNyZWF0ZVNlcnZpY2VPcmRlcihuYW1lLCBwcmljZSwgZGVzY3JpcHRpb24sIGlkKSB7XG4gICAgY29uc3QgSFRNTFN0cmluZyA9IGBcbiAgICA8ZGl2IGNsYXNzPVwib3JkZXItY29udGFpbmVyIG9yZGVyLXNlcnZpY2VcIiBpZD1cInNlcnZpY2Uke2lkfVwiPlxuICAgIDxkaXYgY2xhc3M9XCJjcm9zc1wiIGlkPVwiY3Jvc3Mke2lkfVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY3Jvc3Mtb25lXCI+IDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY3Jvc3MtdHdvXCI+PC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cIm9yZGVyLXJvd1wiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwib3JkZXItaW5mb1wiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm9yZGVyLWhlYWRlclwiPiR7bmFtZX08L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJvcmRlci1jb3N0XCI+JHtwcmljZX0g4oK9IC8g0YfQsNGBPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJvcmRlci1jb250ZW50XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb250ZW50LWhlYWRlclwiPtCe0L/QuNGB0LDQvdC40LU8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbnRlbnQtZGVzY3JpcHRpb25cIj5cbiAgICAgICAgICAgIDxkaXY+JHtkZXNjcmlwdGlvbn08L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj5cbiAgICBgO1xuICAgIHJldHVybiBIVE1MU3RyaW5nO1xuICB9XG4gIGZ1bmN0aW9uIGNyZWF0ZVNlcnZpY2VUb3RhbChuYW1lLCBwcmljZSwgaWQpIHtcbiAgICBjb25zdCBIVE1MU3RyaW5nID1cbiAgICAgIGBcbiAgICAgIDxkaXYgY2xhc3M9XCJvcmRlci1pdGVtIG9yZGVyLWl0ZW0tLXNlcnZpY2VcIiBpZD1cInRvdGFsT3JkZXJJRCR7aWR9XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJvcmRlci1pdGVtX19uYW1lXCIgaWQ9XCJvcmRlclNlcnZpY2VOYW1lXCI+JHtuYW1lfTwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwib3JkZXItaXRlbV9fYmFyXCI+IDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwib3JkZXItaXRlbV9fcHJpY2VcIiBpZD1cIm9yZGVyU2VydmljZVByaWNlXCI+JHtwcmljZX0gPHNwYW4+4oK9PC9zcGFuPjwvZGl2PlxuICAgIDwvZGl2PlxuICAgIGA7XG4gICAgcmV0dXJuIEhUTUxTdHJpbmc7XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGVVc2VyT3JkZXJGaWVsZCgpIHtcbiAgICBjb25zdCB1c2VyT3JkZXJGaWVsZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidXNlck9yZGVyXCIpO1xuICAgIGNvbnN0IHVzZXJPcmRlckxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm9yZGVyLWl0ZW1cIik7XG4gICAgY29uc3QgdG90YWxQcmljZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3JkZXJUb3RhbFByaWNlXCIpLnRleHRDb250ZW50O1xuICAgIGxldCBvcmRlclN0cmluZyA9ICcnO1xuICAgIHVzZXJPcmRlckxpc3QuZm9yRWFjaChvcmRlciA9PiB7XG4gICAgICBjb25zdCBvcmRlck5hbWUgPSBvcmRlci5xdWVyeVNlbGVjdG9yKFwiLm9yZGVyLWl0ZW1fX25hbWVcIikudGV4dENvbnRlbnQ7XG4gICAgICBjb25zdCBvcmRlclByaWNlID0gb3JkZXIucXVlcnlTZWxlY3RvcihcIi5vcmRlci1pdGVtX19wcmljZVwiKS50ZXh0Q29udGVudDtcbiAgICAgIG9yZGVyU3RyaW5nID0gYCR7b3JkZXJTdHJpbmd9ICR7b3JkZXJOYW1lfSAtICR7b3JkZXJQcmljZX0uICBgXG4gICAgfSk7XG4gICAgbGV0IHRvdGFsU3RyaW5nID0gYNCS0YHQtdCz0L46ICR7dG90YWxQcmljZX1gO1xuICAgIG9yZGVyU3RyaW5nICs9IHRvdGFsU3RyaW5nO1xuICAgIHVzZXJPcmRlckZpZWxkLnZhbHVlID0gb3JkZXJTdHJpbmc7XG4gICAgY29uc29sZS5sb2codXNlck9yZGVyRmllbGQudmFsdWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gdXBkYXRlVG90YWxOdW1iZXIoKSB7XG4gICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIub3JkZXItaXRlbV9fcHJpY2VcIikpIHtcbiAgICAgIGNvbnN0IGFsbE9yZGVyc051bXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm9yZGVyLWl0ZW1fX3ByaWNlXCIpO1xuICAgICAgY29uc3QgdG90YWxOdW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm9yZGVyVG90YWxQcmljZVwiKTtcbiAgICAgIGxldCB0b3RhbFN1bSA9IDA7XG4gICAgICBhbGxPcmRlcnNOdW1zLmZvckVhY2gocHJpY2UgPT4ge1xuICAgICAgICB2YXIgcmVhbFByaWNlID0gcGFyc2VJbnQocHJpY2UudGV4dENvbnRlbnQpXG4gICAgICAgIHRvdGFsU3VtICs9IHJlYWxQcmljZTtcbiAgICAgIH0pXG4gICAgICBsZXQgdG90YWxOdW1GaW5hbCA9IHRvdGFsTnVtLmNoaWxkTm9kZXNbMF07XG4gICAgICB0b3RhbE51bUZpbmFsLm5vZGVWYWx1ZSA9IHRvdGFsU3VtICsgJyAnO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGNvbnN0IHRvdGFsTnVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvcmRlclRvdGFsUHJpY2VcIik7XG4gICAgICBsZXQgdG90YWxTdW0gPSAwO1xuICAgICAgbGV0IHRvdGFsTnVtRmluYWwgPSB0b3RhbE51bS5jaGlsZE5vZGVzWzBdO1xuICAgICAgdG90YWxOdW1GaW5hbC5ub2RlVmFsdWUgPSB0b3RhbFN1bSArICcgJztcbiAgICB9XG4gIH1cbiAgc2V0VGltZW91dCh1cGRhdGVUb3RhbE51bWJlciwgMTAwKVxuICBzZXRUaW1lb3V0KGRlbGV0ZU9yZGVyRnJvbUxpc3RzLCAxMDApXG4gIHNldFRpbWVvdXQodXBkYXRlVXNlck9yZGVyRmllbGQsIDEwMClcblxuICBmdW5jdGlvbiBkZWxldGVPcmRlckZyb21MaXN0cygpIHtcbiAgICBjb25zdCBhbGxDcm9zc2VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5jcm9zc1wiKTtcbiAgICB2YXIgb3JkZXJDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm9yZGVycy1jb250YWluZXJcIik7XG4gICAgdmFyIG9yZGVyTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIub3JkZXItbGlzdFwiKTtcbiAgICBhbGxDcm9zc2VzLmZvckVhY2goY3Jvc3MgPT4ge1xuICAgICAgY3Jvc3MuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgbGV0IGNyb3NzQ291bnRlciA9IGNyb3NzLmlkLnJlcGxhY2UoJ2Nyb3NzJywgJycpO1xuXG4gICAgICAgIGNvbnN0IG9yZGVySXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBzZXJ2aWNlJHtjcm9zc0NvdW50ZXJ9YCk7XG4gICAgICAgIGNvbnN0IG9yZGVyVG90YWxJdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHRvdGFsT3JkZXJJRCR7Y3Jvc3NDb3VudGVyfWApO1xuICAgICAgICBvcmRlckNvbnRhaW5lci5yZW1vdmVDaGlsZChvcmRlckl0ZW0pO1xuICAgICAgICBvcmRlckxpc3QucmVtb3ZlQ2hpbGQob3JkZXJUb3RhbEl0ZW0pO1xuICAgICAgICB1cGRhdGVUb3RhbE51bWJlcigpO1xuICAgICAgICB1cGRhdGVVc2VyT3JkZXJGaWVsZCgpXG5cbiAgICAgICAgY3Jvc3NDb3VudGVyID0gcGFyc2VJbnQoY3Jvc3NDb3VudGVyKTtcbiAgICAgICAgdmFyIGZpbHRlcmVkQXJyYXkgPSBib29rc0FycmF5LmZpbHRlcihmdW5jdGlvbiAodmFsdWUsIGluZGV4LCBhcnIpIHtcbiAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnNlcnZpY2VDb3VudGVyO1xuICAgICAgICAgIHJldHVybiB2YWx1ZSAhPSBjcm9zc0NvdW50ZXI7XG4gICAgICAgIH0pO1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0T2JqKFwiYm9va2VkU2VydmljZXNcIiwgZmlsdGVyZWRBcnJheSk7XG4gICAgICB9KVxuICAgIH0pXG4gIH1cbiAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICQoXCIjdXNlclBob25lXCIpLmlucHV0bWFzaygpO1xuICB9KTtcblxufVxuIl19
